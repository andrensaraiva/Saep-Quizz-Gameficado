<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0d1117">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Painel Administrativo - Quiz Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="admin-body">
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Header -->
    <header class="admin-header">
        <div class="container header-content">
            <h1>‚öôÔ∏è Painel Administrativo</h1>
            <nav>
                <span id="admin-username"></span>
                <button onclick="showHelpModal()" class="btn-success" style="margin-right: 10px;">‚ùì Ajuda</button>
                <button onclick="backToMain()" class="btn-secondary">‚Üê Voltar ao Quiz</button>
                <button onclick="logout()" class="btn-danger">Sair</button>
            </nav>
        </div>
    </header>

    <!-- Sidebar -->
    <div class="admin-layout">
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <span class="icon">üìä</span> Dashboard
                </a>
                <a href="#" class="nav-item" onclick="showSection('courses')">
                    <span class="icon">üìö</span> Cursos
                </a>
                <a href="#" class="nav-item" onclick="showSection('quizzes')">
                    <span class="icon">üìù</span> Quizzes
                </a>
                <a href="#" class="nav-item" onclick="showSection('questions')">
                    <span class="icon">‚ùì</span> Quest√µes
                </a>
                <a href="#" class="nav-item" onclick="showSection('users')">
                    <span class="icon">üë•</span> Usu√°rios
                </a>
                <a href="#" class="nav-item" onclick="showSection('turmas')">
                    <span class="icon">üè´</span> Turmas
                </a>
                <a href="#" class="nav-item" onclick="showSection('results')">
                    <span class="icon">üìä</span> Resultados
                </a>
                <a href="#" class="nav-item" onclick="showSection('feedbacks')">
                    <span class="icon">üí¨</span> Feedbacks
                </a>
                <a href="#" class="nav-item" onclick="showSection('reports')">
                    <span class="icon">üìà</span> Relat√≥rios
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-content">
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="admin-section">
                <h2>Dashboard Geral</h2>
                
                <div class="stats-grid-admin">
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üë•</div>
                        <div class="stat-value-admin" id="dash-total-users">0</div>
                        <div class="stat-label-admin">Total de Usu√°rios</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">ÔøΩ‚Äçüè´</div>
                        <div class="stat-value-admin" id="dash-total-professors">0</div>
                        <div class="stat-label-admin">Professores</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üë®‚Äçüéì</div>
                        <div class="stat-value-admin" id="dash-total-students">0</div>
                        <div class="stat-label-admin">Alunos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üè´</div>
                        <div class="stat-value-admin" id="dash-total-turmas">0</div>
                        <div class="stat-label-admin">Turmas</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üìö</div>
                        <div class="stat-value-admin" id="dash-total-courses">0</div>
                        <div class="stat-label-admin">Cursos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">‚ùì</div>
                        <div class="stat-value-admin" id="dash-total-questions">0</div>
                        <div class="stat-label-admin">Quest√µes</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üìù</div>
                        <div class="stat-value-admin" id="dash-total-attempts">0</div>
                        <div class="stat-label-admin">Tentativas</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üìä</div>
                        <div class="stat-value-admin" id="dash-average-score">0%</div>
                        <div class="stat-label-admin">M√©dia Geral</div>
                    </div>
                </div>

                <div class="dashboard-grid" style="margin-top: 20px;">
                    <div class="dashboard-card">
                        <h3>üìà Vis√£o Geral</h3>
                        <div style="position: relative; height: 250px;">
                            <canvas id="admin-overview-chart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Atividades Recentes</h3>
                        <div id="recent-activities"></div>
                    </div>
                </div>
            </section>

            <!-- Courses Section -->
            <section id="courses-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>Gerenciar Cursos</h2>
                    <button onclick="showAddCourseModal()" class="btn-primary">+ Novo Curso</button>
                </div>

                <div id="courses-list"></div>
            </section>

            <!-- Quizzes Section -->
            <section id="quizzes-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>Gerenciar Quizzes</h2>
                    <div class="button-group-horizontal">
                        <button onclick="showSimuladoWizard()" class="btn-success">ü§ñ Gerar Simulado com IA</button>
                        <button onclick="showAddQuizModal()" class="btn-primary">+ Novo Quiz Manual</button>
                    </div>
                </div>

                <div id="quizzes-list"></div>
            </section>

            <!-- Questions Section -->
            <section id="questions-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>Gerenciar Quest√µes</h2>
                    <div class="button-group-horizontal">
                        <select id="course-filter" onchange="loadQuestionsByCourse()" class="form-select">
                            <option value="">Selecione um curso...</option>
                        </select>
                        <button onclick="showAIQuestionModal()" class="btn-success">ü§ñ Gerar com IA</button>
                        <button onclick="showAddQuestionModal()" class="btn-primary">+ Nova Quest√£o</button>
                        <button onclick="showImportModal()" class="btn-success">üì§ Importar em Lote</button>
                    </div>
                </div>

                <div id="questions-list"></div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="admin-section" style="display:none;">
                <h2>Gerenciar Usu√°rios</h2>
                <p style="color:#94a3b8;margin-bottom:16px;">Altere o papel (role) de cada usu√°rio: <strong>user</strong> (aluno), <strong>professor</strong> ou <strong>admin</strong>.</p>
                <div id="users-list"></div>
            </section>

            <!-- Turmas Section -->
            <section id="turmas-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>üè´ Gerenciar Turmas</h2>
                </div>
                <div id="admin-turmas-list"></div>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>Resultados dos Quizzes</h2>
                    <div class="button-group-horizontal">
                        <button onclick="loadAnonymousResults()" class="btn-primary">Carregar Resultados</button>
                        <select id="results-course-filter" onchange="loadAnonymousResults()" class="form-control" style="width: auto; margin-left: 10px;">
                            <option value="">Todos os Cursos</option>
                        </select>
                    </div>
                </div>

                <div class="stats-grid-admin" style="margin-bottom: 20px;">
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üìù</div>
                        <div class="stat-value-admin" id="results-total">0</div>
                        <div class="stat-label-admin">Total de Tentativas</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üìä</div>
                        <div class="stat-value-admin" id="results-avg-score">0%</div>
                        <div class="stat-label-admin">M√©dia de Acertos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">‚è±Ô∏è</div>
                        <div class="stat-value-admin" id="results-avg-time">00:00</div>
                        <div class="stat-label-admin">Tempo M√©dio</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üéØ</div>
                        <div class="stat-value-admin" id="results-best-score">0%</div>
                        <div class="stat-label-admin">Melhor Resultado</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Resultados Recentes</h3>
                    <div id="results-list">
                        <p style="text-align: center; color: #94a3b8; padding: 20px;">
                            Clique em "Carregar Resultados" para ver as tentativas dos usu√°rios
                        </p>
                    </div>
                </div>
            </section>

            <!-- Feedbacks Section -->
            <section id="feedbacks-section" class="admin-section" style="display:none;">
                <div class="section-header">
                    <h2>Feedbacks e Sugest√µes</h2>
                    <div class="button-group-horizontal">
                        <button onclick="loadFeedbacks('novo')" class="btn-secondary">Novos</button>
                        <button onclick="loadFeedbacks('lido')" class="btn-secondary">Lidos</button>
                        <button onclick="loadFeedbacks('respondido')" class="btn-success">Respondidos</button>
                        <button onclick="loadFeedbacks()" class="btn-primary">Todos</button>
                    </div>
                </div>

                <div class="stats-grid-admin" style="margin-bottom: 20px;">
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üÜï</div>
                        <div class="stat-value-admin" id="feedback-novo">0</div>
                        <div class="stat-label-admin">Novos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üëÅÔ∏è</div>
                        <div class="stat-value-admin" id="feedback-lido">0</div>
                        <div class="stat-label-admin">Lidos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">‚úÖ</div>
                        <div class="stat-value-admin" id="feedback-respondido">0</div>
                        <div class="stat-label-admin">Respondidos</div>
                    </div>
                    <div class="stat-card-admin">
                        <div class="stat-icon-admin">üí¨</div>
                        <div class="stat-value-admin" id="feedback-total">0</div>
                        <div class="stat-label-admin">Total</div>
                    </div>
                </div>

                <div id="feedbacks-list"></div>
            </section>

            <!-- Reports Section -->
            <section id="reports-section" class="admin-section" style="display:none;">
                <h2>Relat√≥rios</h2>
                
                <div class="reports-tools">
                    <div class="tool-card">
                        <h3>Exportar Dados</h3>
                        <div class="button-group-vertical">
                            <button onclick="exportData('users')" class="btn-secondary">üë§ Exportar Usu√°rios (CSV)</button>
                            <button onclick="exportData('courses')" class="btn-secondary">üìö Exportar Cursos (CSV)</button>
                            <button onclick="exportData('scores')" class="btn-secondary">üèÜ Exportar Pontua√ß√µes (CSV)</button>
                            <button onclick="exportData('turmas')" class="btn-secondary">üè´ Exportar Turmas (CSV)</button>
                            <button onclick="exportData('questions')" class="btn-secondary">‚ùì Exportar Quest√µes (CSV)</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h3>Relat√≥rio por Curso</h3>
                        <select id="report-course-select" class="form-select">
                            <option value="">Selecione um curso...</option>
                        </select>
                        <button onclick="generateCourseReport()" class="btn-primary" style="margin-top: 10px; width: 100%;">Gerar Relat√≥rio</button>
                    </div>
                </div>

                <div id="report-content"></div>
            </section>
        </main>
    </div>

    <!-- Modal: Adicionar/Editar Curso -->
    <div id="add-course-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('add-course-modal')">&times;</span>
            <h2 id="course-modal-title">Adicionar Novo Curso</h2>
            <form onsubmit="handleAddCourse(event)">
                <div class="form-group">
                    <label>Nome do Curso:</label>
                    <input type="text" id="course-name" placeholder="Nome do Curso" required>
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o:</label>
                    <textarea id="course-description" placeholder="Descri√ß√£o do curso" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Categoria:</label>
                    <input type="text" id="course-category" placeholder="ex: Tecnologia, Sa√∫de..." required>
                </div>
                
                <div class="form-group">
                    <label>Cor do Curso:</label>
                    <input type="color" id="course-color" value="#3b82f6">
                </div>

                <div class="form-group">
                    <label>Capacidades e Habilidades:</label>
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 15px;">
                        Defina as capacidades do curso e as habilidades de cada capacidade. 
                        Isso ser√° usado para gerar quest√µes com IA de forma mais precisa.
                    </p>
                    
                    <div id="capacities-container" style="border: 1px solid var(--border); border-radius: 8px; padding: 15px; background: var(--bg-surface);">
                        <!-- Capacidades ser√£o adicionadas aqui dinamicamente -->
                    </div>
                    
                    <button type="button" onclick="addCapacity()" class="btn-secondary" style="margin-top: 10px;">
                        + Adicionar Capacidade
                    </button>
                </div>

                <button type="submit" class="btn-large btn-primary" style="margin-top: 20px;">Salvar Curso</button>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar Quest√£o -->
    <div id="add-question-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('add-question-modal')">&times;</span>
            <h2>Adicionar Nova Quest√£o</h2>
            <form onsubmit="handleAddQuestion(event)">
                <select id="question-course" required class="form-select">
                    <option value="">Selecione o curso...</option>
                </select>
                <input type="text" id="question-id" placeholder="ID da Quest√£o (ex: q1)" required>
                <input type="text" id="question-capacity" placeholder="Capacidade/Categoria (ex: C1)" required>
                
                <label for="question-difficulty">Dificuldade:</label>
                <select id="question-difficulty" required class="form-select">
                    <option value="F√°cil">F√°cil</option>
                    <option value="M√©dio" selected>M√©dio</option>
                    <option value="Dif√≠cil">Dif√≠cil</option>
                </select>
                
                <textarea id="question-context" placeholder="Contexto da quest√£o" required></textarea>
                <input type="url" id="question-context-image" placeholder="URL da imagem do contexto (opcional)">
                <textarea id="question-command" placeholder="Pergunta" required></textarea>
                
                <h4>Op√ß√µes (pelo menos 2) ‚Äî texto e imagem s√£o opcionais, mas uma deve ser correta:</h4>
                <div id="options-container"></div>
                <button type="button" onclick="addOption()" class="btn-secondary">+ Adicionar Op√ß√£o</button>
                
                <button type="submit" class="btn-large btn-primary" style="margin-top: 20px;">Criar Quest√£o</button>
            </form>
        </div>
    </div>

    <!-- Modal: Criar Quiz -->
    <div id="quiz-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('quiz-modal')">&times;</span>
            <h2 id="quiz-modal-title">Novo Quiz</h2>
            
            <form id="quiz-form" onsubmit="handleQuizSubmit(event)">
                <div class="form-group">
                    <label>Nome do Quiz:</label>
                    <input type="text" id="quiz-name" required placeholder="Ex: Prova Bimestral, Quiz de L√≥gica, etc.">
                </div>

                <div class="form-group">
                    <label>Descri√ß√£o:</label>
                    <textarea id="quiz-description" rows="3" placeholder="Descri√ß√£o opcional do quiz"></textarea>
                </div>

                <div class="form-group">
                    <label>Curso:</label>
                    <select id="quiz-course" required onchange="loadQuestionsForQuiz()">
                        <option value="">Selecione o curso...</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div class="form-group" style="margin: 0;">
                        <label>Filtrar por Capacidade:</label>
                        <select id="quiz-filter-capacity" onchange="loadQuestionsForQuiz()">
                            <option value="">Todas as Capacidades</option>
                            <option value="C1">C1 - Planejamento e Documenta√ß√£o</option>
                            <option value="C2">C2 - Desenvolvimento e Implementa√ß√£o</option>
                            <option value="C3">C3 - Testes, Qualidade e Deploy</option>
                            <option value="C4">C4 - Metodologias e Gest√£o</option>
                            <option value="C5">C5 - Performance e Otimiza√ß√£o</option>
                            <option value="Geral">Geral</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin: 0;">
                        <label>Filtrar por Dificuldade:</label>
                        <select id="quiz-filter-difficulty" onchange="loadQuestionsForQuiz()">
                            <option value="">Todas as Dificuldades</option>
                            <option value="F√°cil">üü¢ F√°cil</option>
                            <option value="M√©dio">üü° M√©dio</option>
                            <option value="Dif√≠cil">üî¥ Dif√≠cil</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label style="font-weight: 600; font-size: 1rem; color: var(--text-primary); margin-bottom: 10px; display: block;">Quest√µes do Quiz:</label>
                    <div id="quiz-questions-container" style="max-height: 500px; overflow-y: auto; border: 1px solid var(--border); padding: 12px; border-radius: 10px; background: var(--bg-surface);">
                        <p style="color: var(--text-muted); text-align: center; padding: 30px 20px;">Selecione um curso primeiro...</p>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <small style="flex: 1; color: var(--text-muted); font-size: 0.9rem; display: flex; align-items: center;">
                            ‚úì Clique em qualquer quest√£o para selecion√°-la
                        </small>
                        <button type="button" onclick="selectAllQuestions()" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">
                            ‚úì Todas
                        </button>
                        <button type="button" onclick="deselectAllQuestions()" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">
                            ‚úó Nenhuma
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn-large btn-primary" style="margin-top: 20px;">Salvar Quiz</button>
            </form>
        </div>
    </div>

    <!-- Modal: Gerar Quest√£o com IA -->
    <div id="ai-question-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('ai-question-modal')">&times;</span>
            <h2>ü§ñ Gerar Quest√£o com Intelig√™ncia Artificial</h2>
            
            <div class="info-box">
                <h4>üí° Como funciona:</h4>
                <p>Preencha os campos abaixo e a IA ir√° gerar uma quest√£o completa de m√∫ltipla escolha para voc√™ revisar e aprovar.</p>
            </div>

            <form onsubmit="handleGenerateAIQuestion(event)">
                <div class="form-group">
                    <label>Provedor de IA:</label>
                    <select id="ai-provider" required class="form-select">
                        <option value="gemini">Google Gemini (Gratuito)</option>
                        <option value="chatgpt">ChatGPT (Requer API Key)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Curso de Destino:</label>
                    <select id="ai-course" required class="form-select" onchange="loadCapacitiesForAI()">
                        <option value="">Selecione o curso...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Capacidade/Compet√™ncia:</label>
                    <select id="ai-capacity" required class="form-select" onchange="loadSkillsForAI()">
                        <option value="">Primeiro selecione um curso...</option>
                    </select>
                    <small>A categoria ou compet√™ncia que esta quest√£o avalia</small>
                </div>

                <div class="form-group">
                    <label>Habilidade Espec√≠fica:</label>
                    <select id="ai-skill" required class="form-select">
                        <option value="">Primeiro selecione uma capacidade...</option>
                    </select>
                    <small>A habilidade espec√≠fica dentro da capacidade escolhida</small>
                </div>

                <div class="form-group">
                    <label>Conte√∫do/Contexto Adicional (opcional):</label>
                    <textarea id="ai-content" placeholder="Ex: Foque em exemplos pr√°ticos com arrays, inclua cen√°rio de jogo, etc." rows="3"></textarea>
                    <small>Detalhes extras para personalizar a quest√£o gerada</small>
                </div>

                <div class="form-group">
                    <label>N√≠vel de Dificuldade:</label>
                    <select id="ai-difficulty" required class="form-select">
                        <option value="f√°cil">F√°cil</option>
                        <option value="m√©dio">M√©dio</option>
                        <option value="dif√≠cil">Dif√≠cil</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Imagens autom√°ticas:</label>
                    <label class="toggle-label">
                        <input type="checkbox" id="ai-include-context-images" checked>
                        <span>Gerar imagem para o contexto da quest√£o</span>
                    </label>
                    <label class="toggle-label">
                        <input type="checkbox" id="ai-include-option-images">
                        <span>Gerar imagens para as alternativas</span>
                    </label>
                    <small>Use Pollinations AI para gerar ilustra√ß√µes automaticamente (sem custos adicionais).</small>
                </div>

                <div class="form-group">
                    <label>Provedor de imagens:</label>
                    <select id="ai-image-provider" class="form-select">
                        <option value="pollinations">Pollinations (gratuito)</option>
                    </select>
                    <small>Integra√ß√£o com outros provedores, como Gemini Imagens, chegar√° em breve.</small>
                </div>

                <div class="button-group-vertical">
                    <button type="submit" class="btn-large btn-success" id="generate-btn">
                        ü§ñ Gerar Quest√£o
                    </button>
                </div>
            </form>

            <!-- Preview da quest√£o gerada -->
            <div id="ai-preview" style="display:none; margin-top: 20px;">
                <hr>
                <h3>üìù Quest√£o Gerada - Revisar antes de salvar</h3>
                <div id="ai-question-preview" class="question-preview"></div>
                
                <div class="button-group-horizontal" style="margin-top: 20px;">
                    <button onclick="approveAIQuestion()" class="btn-primary">‚úì Aprovar e Salvar</button>
                    <button onclick="rejectAIQuestion()" class="btn-danger">‚úó Rejeitar e Gerar Outra</button>
                    <button onclick="editAIQuestion()" class="btn-secondary">‚úèÔ∏è Editar Manualmente</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Gerador de Simulado com IA -->
    <div id="simulado-wizard-modal" class="modal">
        <div class="modal-content" style="max-width: 900px; width: 95%;">
            <span class="close" onclick="closeModal('simulado-wizard-modal')">&times;</span>
            <h2>ü§ñ Gerador de Simulado Completo com IA</h2>

            <div class="info-box" style="margin-bottom: 18px;">
                <h4>üí° Como funciona:</h4>
                <p>1. Escolha o curso e a quantidade de quest√µes.<br>
                   2. Defina o tema/capacidade de <strong>cada quest√£o</strong>.<br>
                   3. A IA gera todas as quest√µes no padr√£o SAEP.<br>
                   4. Revise, edite, exclua ou regenere cada quest√£o individualmente.<br>
                   5. Aprove e salve o simulado completo.</p>
            </div>

            <!-- STEP 1: Config -->
            <div id="sim-step-config">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
                    <div class="form-group" style="margin:0;">
                        <label>Curso de Destino:</label>
                        <select id="sim-course" required class="form-select" onchange="loadSimCapacities()">
                            <option value="">Selecione o curso...</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label>Provedor de IA:</label>
                        <select id="sim-provider" class="form-select">
                            <option value="gemini">Google Gemini (Gratuito)</option>
                            <option value="chatgpt">ChatGPT (Requer API Key)</option>
                        </select>
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px;">
                    <div class="form-group" style="margin:0;">
                        <label>Quantidade de Quest√µes:</label>
                        <input type="number" id="sim-count" min="1" max="20" value="5" class="form-select" style="width:100%;">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label>üñºÔ∏è Imagem no Contexto:</label>
                        <select id="sim-context-images" class="form-select">
                            <option value="false">N√£o gerar</option>
                            <option value="true">Gerar imagens</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label>üñºÔ∏è Imagens nas Alternativas:</label>
                        <select id="sim-option-images" class="form-select">
                            <option value="false">N√£o gerar</option>
                            <option value="true">Gerar imagens</option>
                        </select>
                    </div>
                </div>

                <hr style="border-color:#334155;margin:18px 0;">

                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                    <h3 style="margin:0;">üìã Temas de Cada Quest√£o</h3>
                    <button type="button" onclick="applyDefaultThemeToAll()" class="btn-secondary" style="font-size:0.85rem;">Aplicar padr√£o a todas</button>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:14px;background:#1e293b;padding:12px;border-radius:10px;">
                    <div class="form-group" style="margin:0;">
                        <label style="font-size:0.8rem;">Capacidade padr√£o:</label>
                        <select id="sim-default-capacity" class="form-select" onchange="loadSimDefaultSkills()">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label style="font-size:0.8rem;">Habilidade padr√£o:</label>
                        <select id="sim-default-skill" class="form-select">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label style="font-size:0.8rem;">Dificuldade padr√£o:</label>
                        <select id="sim-default-difficulty" class="form-select">
                            <option value="f√°cil">F√°cil</option>
                            <option value="m√©dio" selected>M√©dio</option>
                            <option value="dif√≠cil">Dif√≠cil</option>
                        </select>
                    </div>
                </div>

                <div id="sim-questions-config" style="max-height:400px;overflow-y:auto;border:1px solid #334155;border-radius:10px;padding:12px;background:#0d1117;">
                    <p style="color:#94a3b8;text-align:center;">Selecione um curso e defina a quantidade de quest√µes.</p>
                </div>

                <div style="margin-top:18px;display:flex;gap:12px;justify-content:flex-end;">
                    <button type="button" onclick="closeModal('simulado-wizard-modal')" class="btn-secondary">Cancelar</button>
                    <button type="button" onclick="startSimuladoGeneration()" class="btn-large btn-success" id="sim-generate-btn">
                        ü§ñ Gerar Simulado Completo
                    </button>
                </div>
            </div>

            <!-- STEP 2: Progress -->
            <div id="sim-step-progress" style="display:none;">
                <div style="text-align:center;padding:30px 0;">
                    <div style="font-size:3rem;margin-bottom:16px;">‚è≥</div>
                    <h3 id="sim-progress-title">Gerando quest√µes...</h3>
                    <div style="width:100%;background:#1e293b;border-radius:10px;height:24px;overflow:hidden;margin:16px 0;">
                        <div id="sim-progress-bar" style="height:100%;background:linear-gradient(90deg,#6366f1,#8b5cf6);border-radius:10px;width:0%;transition:width 0.5s ease;"></div>
                    </div>
                    <p id="sim-progress-detail" style="color:#94a3b8;">Aguarde enquanto a IA gera suas quest√µes...</p>
                </div>
            </div>

            <!-- STEP 3: Review -->
            <div id="sim-step-review" style="display:none;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
                    <h3 style="margin:0;">üìù Revisar Quest√µes Geradas</h3>
                    <div style="display:flex;gap:8px;">
                        <span id="sim-review-count" style="color:#94a3b8;font-size:0.9rem;align-self:center;"></span>
                    </div>
                </div>

                <div id="sim-review-list" style="max-height:500px;overflow-y:auto;"></div>

                <div style="margin-top:18px;">
                    <div class="form-group">
                        <label>Nome do Simulado:</label>
                        <input type="text" id="sim-quiz-name" required placeholder="Ex: Simulado SAEP - Jogos Digitais" class="form-select" style="width:100%;">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o (opcional):</label>
                        <textarea id="sim-quiz-description" rows="2" placeholder="Descri√ß√£o do simulado..." style="width:100%;"></textarea>
                    </div>
                </div>

                <div style="margin-top:14px;display:flex;gap:12px;justify-content:flex-end;flex-wrap:wrap;">
                    <button type="button" onclick="goBackToSimConfig()" class="btn-secondary">‚Üê Voltar e Ajustar</button>
                    <button type="button" onclick="saveSimulado()" class="btn-large btn-primary" id="sim-save-btn">
                        ‚úÖ Aprovar e Salvar Simulado
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Editar Quest√£o do Simulado -->
    <div id="sim-edit-question-modal" class="modal">
        <div class="modal-content" style="max-width:800px;">
            <span class="close" onclick="closeModal('sim-edit-question-modal')">&times;</span>
            <h2>‚úèÔ∏è Editar Quest√£o do Simulado</h2>

            <div class="form-group">
                <label>Contexto:</label>
                <textarea id="sim-edit-context" rows="4" style="width:100%;"></textarea>
            </div>
            <div class="form-group">
                <label>Comando (Pergunta):</label>
                <input type="text" id="sim-edit-command" style="width:100%;">
            </div>
            <div class="form-group">
                <label>URL da Imagem de Contexto (opcional):</label>
                <input type="text" id="sim-edit-context-image" style="width:100%;" placeholder="https://...">
            </div>

            <div id="sim-edit-options-container"></div>

            <div style="margin-top:16px;display:flex;gap:12px;justify-content:flex-end;">
                <button type="button" onclick="closeModal('sim-edit-question-modal')" class="btn-secondary">Cancelar</button>
                <button type="button" onclick="saveSimEditedQuestion()" class="btn-primary">üíæ Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <!-- Modal: Importar Quest√µes -->
    <div id="import-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('import-modal')">&times;</span>
            <h2>Importar Quest√µes em Lote</h2>
            
            <div class="info-box">
                <h4>üìã Formato do arquivo JSON:</h4>
                <p>Cole um array JSON com suas quest√µes no formato:</p>
                <pre style="background: var(--bg-surface); padding: 12px; border-radius: var(--radius-sm); overflow-x: auto; border: 1px solid var(--border); color: var(--text-secondary); font-size: 0.85rem;">
[
  {
    "id": "q1",
    "capacidade": "C1",
        "context": "Contexto...",
        "contextImage": "https://exemplo.com/imagem-contexto.jpg",
    "command": "Pergunta?",
    "options": [
            { "text": "Op√ß√£o 1", "justification": "Por que est√° errada", "image": "https://exemplo.com/opcao-1.jpg" },
            { "text": "Op√ß√£o 2", "correct": true, "image": "https://exemplo.com/opcao-2.jpg" }
    ]
  }
]</pre>
            </div>

            <form onsubmit="handleImportQuestions(event)">
                <select id="import-course" required class="form-select">
                    <option value="">Selecione o curso...</option>
                </select>
                <textarea id="import-json" placeholder="Cole aqui o JSON com as quest√µes..." rows="10" required></textarea>
                <button type="submit" class="btn-large btn-success">Importar Quest√µes</button>
            </form>
        </div>
    </div>

    <!-- Modal: Ajuda/Tutoriais -->
    <div id="help-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeModal('help-modal')">&times;</span>
            <h2>üìö Central de Ajuda - Painel Administrativo</h2>
            
            <div class="help-section">
                <h3>üéØ Guia R√°pido do Sistema</h3>
                <p>Bem-vindo ao painel administrativo do Quiz SAEP! Aqui voc√™ pode gerenciar cursos, quizzes e quest√µes.</p>
            </div>

            <div class="help-categories">
                <button class="help-category-btn" onclick="showHelpContent('cadastro')">
                    <span class="icon">üë§</span>
                    <div>
                        <strong>Como se Cadastrar</strong>
                        <small>Para alunos e professores</small>
                    </div>
                </button>

                <button class="help-category-btn" onclick="showHelpContent('fazer-quiz')">
                    <span class="icon">‚úèÔ∏è</span>
                    <div>
                        <strong>Como Fazer um Quiz</strong>
                        <small>Guia para alunos</small>
                    </div>
                </button>

                <button class="help-category-btn" onclick="showHelpContent('criar-curso')">
                    <span class="icon">üìö</span>
                    <div>
                        <strong>Como Criar um Curso</strong>
                        <small>Definir capacidades e habilidades</small>
                    </div>
                </button>

                <button class="help-category-btn" onclick="showHelpContent('criar-quiz')">
                    <span class="icon">üìù</span>
                    <div>
                        <strong>Como Criar um Quiz</strong>
                        <small>Selecionar quest√µes personalizadas</small>
                    </div>
                </button>

                <button class="help-category-btn" onclick="showHelpContent('gerar-questao')">
                    <span class="icon">ü§ñ</span>
                    <div>
                        <strong>Gerar Quest√µes com IA</strong>
                        <small>Usar Google Gemini</small>
                    </div>
                </button>

                <button class="help-category-btn" onclick="showHelpContent('relatorios')">
                    <span class="icon">üìä</span>
                    <div>
                        <strong>Como Gerar Relat√≥rios</strong>
                        <small>Visualizar desempenho dos alunos</small>
                    </div>
                </button>
            </div>

            <div id="help-content" class="help-content">
                <p style="text-align: center; color: #94a3b8; padding: 40px;">
                    üëÜ Selecione uma categoria acima para ver o tutorial
                </p>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>
